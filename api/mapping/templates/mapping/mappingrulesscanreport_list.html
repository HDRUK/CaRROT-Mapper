{% extends "base.html" %}

{% block body %}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'scan-report-list' %}">Scan
            reports</a></li>
        <li class="breadcrumb-item">
            {{ scan_report.data_partner }} - {{ scan_report.dataset }}</li>
    </ol>
</nav>

<h2>Mapping Rules</h2>


<form method="post">{% csrf_token %}
  <button type="submit" class="btn btn-success" name='generate' >Auto Generate</button>
</form>

{% if object_list %}

<div class="container">
  <div class="row mx-auto" id='placeholder-svg'>
  </div>
  <div class="row">
  <table class="table">
    <thead>
    <tr>
        <!--<th scope="col">Data Partner</th>
        <th scope="col">Dataset</th>-->
        <th scope="col">Destination Table</th>
        <th scope="col">Destination Field</th>
	<th scope="col">Source Table</th>
	<th scope="col">Source Field</th>
	<th scope="col">Term Map</th>
    </tr>
    </thead>
    <tbody>
      {% for object in object_list %}
      <tr>
        <!--- <td style="width: 25%">{{ object.omop_field. }}</td>--->
        <td style="width: 20%">{{ object.omop_field.table }}</td>
        <td style="width: 20%">{{ object.omop_field.field }}</td>
        <td style="width: 20%">{{ object.source_table }}</td>
        <td style="width: 20%">{{ object.source_field }}</td>
        <td style="width: 20%">
	  <pre> 
	    {{ object.term_mapping }}
	  </pre>
	</td>
      </tr>
      {% endfor %}
    </tbody>
</table>
  </div>
  </div>


{% else %}
<p>There are currently no rules for this scan report.</p>
{% endif %}

<form method="post">{% csrf_token %}
  <button type="submit" class="btn btn-info" name='download-sm' >Download Structural Mapping</button> 
  <button type="submit" class="btn btn-info" name='download-tm' >Download Term Mapping</button>
  <button type="submit" class="btn btn-info" name='download-pk' >Download Person ID Mapping</button>
</form>

<button type="button" id='view_svg' class="btn btn-warning" name='download-sm' >View SVG</button>


  <script>
    $("#view_svg").click(function () {

	  $.ajax({
		type: "POST",
		url: window.location,
		data: {
		      'svg': true,
		      'csrfmiddlewaretoken': '{{ csrf_token }}',
		},
		success: function (data) {
		      var data = $("svg", data);
		      $('#placeholder-svg').append(data);
		},
		error: function(XMLHttpRequest, textStatus, errorThrown){
		      $('#placeholder-svg').html(errorThrown);
		}
	  });

    
    });
  </script>


{% endblock %}

